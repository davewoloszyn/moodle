{"version":3,"file":"embed.min.js","sources":["../src/embed.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Tiny Media plugin Embed class for Moodle.\n *\n * @module      tiny_media/embed\n * @copyright   2022 Huong Nguyen <huongnv13@gmail.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport EmbedModal from './embedmodal';\nimport {getEmbedPermissions} from './options';\nimport {getFilePicker} from 'editor_tiny/options';\nimport {MediaInsert} from './embed/mediainsert';\nimport {\n    getSelectedMediaElement,\n    insertMediaTemplateContext,\n} from './embed/mediahelpers';\nimport {MediaHandler} from './embed/mediahandler';\n\nexport default class MediaEmbed {\n    editor = null;\n    canShowFilePicker = false;\n    canShowFilePickerTrack = false;\n\n    constructor(editor) {\n        const permissions = getEmbedPermissions(editor);\n        const options = getFilePicker(editor, 'media');\n\n        // Indicates whether the file picker can be shown.\n        this.canShowFilePicker = permissions.filepicker && (typeof options !== 'undefined');\n        this.canShowFilePickerTrack = permissions.filepicker && (typeof getFilePicker(editor, 'subtitle') !== 'undefined');\n        this.canShowDropZone = Object.values(options.repositories).some(repository => repository.type === 'upload');\n        this.editor = editor;\n    }\n\n    displayDialogue = async() => {\n        const [mediaType, selectedMedia] = getSelectedMediaElement(this.editor);\n        this.mediaType = mediaType;\n        this.selectedMedia = selectedMedia;\n        this.currentModal = await EmbedModal.create();\n        this.root = this.currentModal.getRoot()[0];\n\n        if (this.selectedMedia) {\n            // Preview the selected media.\n            this.isUpdating = true;\n            this.loadSelectedMedia();\n        } else {\n            const mediaHandler = new MediaHandler(this);\n            mediaHandler.loadTemplatePromise(insertMediaTemplateContext(this));\n            mediaHandler.registerEventListeners(this.currentModal);\n        }\n    };\n\n    loadSelectedMedia = () => {\n        let mediaSource = null;\n        if (this.mediaType === 'link') {\n            mediaSource = this.selectedMedia.href;\n        } else {\n            mediaSource = this.selectedMedia.querySelector('source').src;\n        }\n\n        // Load media preview.\n        const mediaInsert = new MediaInsert(this);\n        mediaInsert.init();\n        mediaInsert.loadMediaPreview(mediaSource);\n\n        const mediaHandler = new MediaHandler(this);\n        mediaHandler.registerEventListeners(this.currentModal);\n    };\n}\n"],"names":["constructor","editor","async","mediaType","selectedMedia","this","currentModal","EmbedModal","create","root","getRoot","isUpdating","loadSelectedMedia","mediaHandler","MediaHandler","loadTemplatePromise","registerEventListeners","mediaSource","href","querySelector","src","mediaInsert","MediaInsert","init","loadMediaPreview","permissions","options","canShowFilePicker","filepicker","canShowFilePickerTrack","canShowDropZone","Object","values","repositories","some","repository","type"],"mappings":"ilBAsCIA,YAAYC,sCAJH,gDACW,kDACK,2CAaPC,gBACPC,UAAWC,gBAAiB,yCAAwBC,KAAKJ,gBAC3DE,UAAYA,eACZC,cAAgBA,mBAChBE,mBAAqBC,oBAAWC,cAChCC,KAAOJ,KAAKC,aAAaI,UAAU,GAEpCL,KAAKD,mBAEAO,YAAa,OACbC,wBACF,OACGC,aAAe,IAAIC,2BAAaT,MACtCQ,aAAaE,qBAAoB,4CAA2BV,OAC5DQ,aAAaG,uBAAuBX,KAAKC,4DAI7B,SACZW,YAAc,KAEdA,YADmB,SAAnBZ,KAAKF,UACSE,KAAKD,cAAcc,KAEnBb,KAAKD,cAAce,cAAc,UAAUC,UAIvDC,YAAc,IAAIC,yBAAYjB,MACpCgB,YAAYE,OACZF,YAAYG,iBAAiBP,aAER,IAAIH,2BAAaT,MACzBW,uBAAuBX,KAAKC,uBA1CnCmB,aAAc,gCAAoBxB,QAClCyB,SAAU,2BAAczB,OAAQ,cAGjC0B,kBAAoBF,YAAYG,iBAAkC,IAAZF,aACtDG,uBAAyBJ,YAAYG,iBAA4D,KAAtC,2BAAc3B,OAAQ,iBACjF6B,gBAAkBC,OAAOC,OAAON,QAAQO,cAAcC,MAAKC,YAAkC,WAApBA,WAAWC,YACpFnC,OAASA"}